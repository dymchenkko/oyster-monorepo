use risc0_zkvm::guest::env;

use std::io::Read;

use p384::ecdsa::signature::hazmat::PrehashVerifier;
use p384::ecdsa::signature::Verifier;
use p384::ecdsa::Signature;
use p384::ecdsa::VerifyingKey;
use sha2::Digest;
use x509_cert::der::Decode;

// Design notes:
// Generally, it asserts a specific structure instead of parsing everything in a generic fashion.
// Helps keep the proving time low at the cost of being less flexible towards structure changes.
// Skips processing certificate extensions and subject/issuers. Verifies only signatures, expiry.

fn main() {
    let raw_signature = [
        48, 101, 2, 48, 6, 79, 12, 11, 17, 224, 42, 37, 140, 155, 53, 160, 253, 255, 110, 205, 250,
        7, 234, 222, 236, 129, 42, 34, 26, 114, 39, 205, 87, 76, 70, 80, 74, 7, 218, 100, 255, 7,
        234, 237, 21, 170, 223, 117, 225, 9, 177, 208, 2, 49, 0, 168, 102, 80, 226, 70, 3, 107,
        201, 220, 73, 38, 36, 18, 166, 81, 212, 61, 47, 19, 177, 166, 46, 14, 26, 201, 151, 245,
        149, 154, 144, 248, 127, 81, 39, 136, 250, 5, 141, 239, 59, 161, 30, 184, 25, 137, 162,
        206, 215,
    ];
    let sig = Signature::from_der(&raw_signature).unwrap();
    let vkey = VerifyingKey::from_sec1_bytes(&[
        4, 152, 125, 172, 31, 121, 146, 192, 17, 174, 103, 215, 179, 247, 29, 235, 146, 74, 172,
        229, 98, 163, 253, 105, 133, 119, 125, 87, 12, 17, 21, 165, 102, 165, 74, 58, 249, 101, 0,
        165, 89, 124, 90, 61, 137, 27, 153, 153, 242, 123, 167, 182, 132, 111, 109, 185, 189, 248,
        252, 211, 70, 94, 10, 70, 174, 74, 202, 40, 185, 45, 156, 231, 75, 167, 232, 173, 143, 145,
        91, 124, 71, 103, 41, 17, 97, 59, 215, 193, 164, 121, 6, 217, 88, 254, 193, 157, 21,
    ])
    .unwrap();
    vkey.verify(
        &[
            48, 130, 2, 69, 160, 3, 2, 1, 2, 2, 21, 0, 153, 184, 9, 212, 122, 23, 24, 182, 27, 155,
            147, 88, 106, 51, 141, 188, 77, 128, 244, 133, 48, 10, 6, 8, 42, 134, 72, 206, 61, 4,
            3, 3, 48, 129, 137, 49, 60, 48, 58, 6, 3, 85, 4, 3, 12, 51, 57, 52, 49, 51, 101, 53,
            52, 55, 99, 52, 101, 56, 100, 55, 55, 49, 46, 122, 111, 110, 97, 108, 46, 101, 117, 45,
            119, 101, 115, 116, 45, 49, 46, 97, 119, 115, 46, 110, 105, 116, 114, 111, 45, 101,
            110, 99, 108, 97, 118, 101, 115, 49, 12, 48, 10, 6, 3, 85, 4, 11, 12, 3, 65, 87, 83,
            49, 15, 48, 13, 6, 3, 85, 4, 10, 12, 6, 65, 109, 97, 122, 111, 110, 49, 11, 48, 9, 6,
            3, 85, 4, 6, 19, 2, 85, 83, 49, 11, 48, 9, 6, 3, 85, 4, 8, 12, 2, 87, 65, 49, 16, 48,
            14, 6, 3, 85, 4, 7, 12, 7, 83, 101, 97, 116, 116, 108, 101, 48, 30, 23, 13, 50, 52, 49,
            49, 48, 56, 48, 55, 50, 51, 49, 51, 90, 23, 13, 50, 52, 49, 49, 48, 57, 48, 55, 50, 51,
            49, 51, 90, 48, 129, 142, 49, 11, 48, 9, 6, 3, 85, 4, 6, 19, 2, 85, 83, 49, 19, 48, 17,
            6, 3, 85, 4, 8, 12, 10, 87, 97, 115, 104, 105, 110, 103, 116, 111, 110, 49, 16, 48, 14,
            6, 3, 85, 4, 7, 12, 7, 83, 101, 97, 116, 116, 108, 101, 49, 15, 48, 13, 6, 3, 85, 4,
            10, 12, 6, 65, 109, 97, 122, 111, 110, 49, 12, 48, 10, 6, 3, 85, 4, 11, 12, 3, 65, 87,
            83, 49, 57, 48, 55, 6, 3, 85, 4, 3, 12, 48, 105, 45, 48, 52, 50, 100, 55, 55, 102, 56,
            97, 100, 98, 100, 50, 53, 51, 54, 57, 46, 101, 117, 45, 119, 101, 115, 116, 45, 49, 46,
            97, 119, 115, 46, 110, 105, 116, 114, 111, 45, 101, 110, 99, 108, 97, 118, 101, 115,
            48, 118, 48, 16, 6, 7, 42, 134, 72, 206, 61, 2, 1, 6, 5, 43, 129, 4, 0, 34, 3, 98, 0,
            4, 51, 51, 98, 183, 137, 224, 105, 99, 133, 124, 223, 109, 113, 20, 75, 93, 244, 1,
            224, 175, 12, 239, 77, 77, 114, 31, 105, 165, 73, 45, 182, 165, 235, 128, 107, 226, 91,
            61, 125, 154, 4, 150, 125, 166, 163, 151, 207, 153, 222, 139, 66, 59, 11, 79, 9, 117,
            247, 178, 161, 73, 15, 120, 170, 162, 112, 118, 254, 29, 199, 188, 155, 225, 21, 235,
            181, 19, 78, 170, 39, 80, 32, 190, 168, 78, 243, 93, 29, 181, 23, 94, 60, 123, 57, 70,
            252, 62, 163, 102, 48, 100, 48, 18, 6, 3, 85, 29, 19, 1, 1, 255, 4, 8, 48, 6, 1, 1,
            255, 2, 1, 0, 48, 14, 6, 3, 85, 29, 15, 1, 1, 255, 4, 4, 3, 2, 2, 4, 48, 29, 6, 3, 85,
            29, 14, 4, 22, 4, 20, 42, 139, 196, 103, 225, 60, 172, 39, 203, 107, 201, 114, 76, 74,
            45, 179, 201, 86, 158, 98, 48, 31, 6, 3, 85, 29, 35, 4, 24, 48, 22, 128, 20, 246, 212,
            48, 121, 113, 73, 132, 54, 237, 40, 72, 148, 50, 144, 138, 250, 5, 123, 253, 73,
        ],
        &sig,
    )
    .unwrap();
}
